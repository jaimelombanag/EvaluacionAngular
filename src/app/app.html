
<div class="container">
  <!-- Encabezado -->
  <header class="header">
    <div class="header-branding">
      <img src="assets/gft-logo.svg" alt="GFT Logo" class="logo">
      <h1>Evaluación de Candidatos</h1>
    </div>
    
    <!-- Controles de Autenticación -->
    <div class="auth-controls">
      @if (authService.isAuthenticated()) {
        <div class="user-info">
          <span>Bienvenido, {{ authService.userName() }}</span>
          <button (click)="authService.signOut()">Cerrar Sesión</button>
        </div>
      } @else {
        <button (click)="authService.signIn()" class="primary">Iniciar Sesión con Google</button>
      }
    </div>
    
  </header>

  <!-- Acciones Principales -->
  <div class="actions">
    <button (click)="newEvaluation()">Nuevo</button>
    <button 
      (click)="saveAndSyncEvaluation()" 
      [disabled]="!authService.isAuthenticated()"
      [title]="authService.isAuthenticated() ? 'Guardar en Google Drive' : 'Inicia sesión para guardar'"
      class="primary">
        Guardar y Sincronizar
    </button>
  </div>

  <!-- Formulario del Candidato -->
  <div class="form-grid">
    <div class="form-group">
      <label for="candidateName">Nombre del Candidato</label>
      <input id="candidateName" type="text" [value]="candidateName()" (input)="onNameChange($event)" placeholder="Ej: Juan Rodríguez">
    </div>
    <div class="form-group">
      <label for="seniority">Nivel</label>
      <select id="seniority" [value]="seniority()" (change)="onSeniorityChange($event)">
        @for (option of seniorityOptions(); track option) {
          <option [value]="option">{{ option }}</option>
        }
      </select>
    </div>
  </div>

  <!-- Lista de Preguntas -->
  <div class="question-list">
    @for (q of questions(); track q.id; let i = $index) {
      <div class="question-item">
        <div class="question-header">
          <h4>{{ i + 1 }}. {{ q.text }}</h4>
          <details>
            <summary>Ver respuesta ideal</summary>
            <p class="ideal-answer">{{ q.idealAnswer }}</p>
          </details>
        </div>
        <div class="form-group">
          <label [for]="q.id + '-score'">Calificación</label>
          <select [id]="q.id + '-score'" [value]="scores()[q.id] || 0" (change)="onScoreChange(q.id.toString(), $event)">
            <option value="1">Cumple</option>
            <option value="0.5">Parcial</option>
            <option value="0">No Cumple</option>
          </select>
        </div>
        <div class="form-group">
          <label [for]="q.id + '-comment'">Comentarios</label>
          <textarea [id]="q.id + '-comment'" [value]="comments()[q.id] || ''" (input)="onCommentChange(q.id.toString(), $event)" rows="3" placeholder="Anotaciones sobre la respuesta del candidato..."></textarea>
        </div>
      </div>
    }
  </div>

  <!-- Resumen de Evaluación -->
  <div class="summary">
    <h3>Resumen</h3>
    <div class="summary-item">
      Puntaje Total: <span>{{ totalScore() }}%</span>
    </div>
    <div class="summary-item">
      Decisión: <span [class]="'decision ' + decision().class">{{ decision().text }}</span>
    </div>
  </div>

  <!-- Historial de Evaluaciones -->
  <div class="history">
    <div class="history-header">
      <h3>Historial</h3>
      <button (click)="exportToXLSX()">Exportar a XLSX</button>
    </div>
    <div class="form-group">
      <label for="filtro">Filtrar por nombre:</label>
      <input id="filtro" type="text" [value]="filterText()" (input)="onFilterChange($event)">
    </div>
    <table class="table">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Nombre</th>
          <th>Nivel</th>
          <th>Puntaje</th>
          <th>Decisión</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (evaluation of filteredEvaluations(); track evaluation.id) {
          <tr>
            <td>{{ evaluation.fecha | date:'short' }}</td>
            <td>{{ evaluation.nombre }}</td>
            <td>{{ evaluation.seniority }}</td>
            <td>{{ evaluation.puntaje }}%</td>
            <td>{{ evaluation.decision }}</td>
            <td>
              <button class="delete-btn" (click)="deleteEvaluation(evaluation.id)">Borrar</button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>
